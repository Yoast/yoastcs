<?xml version="1.0"?>
<ruleset name="WordPress Yoast">
	<description>Yoast Coding Standards</description>

	<!-- ##### WordPress sniffs #####-->
	<rule ref="WordPress">
		<exclude name="Generic.Files.LineEndings.InvalidEOLChar"/>
		<exclude name="Squiz.WhiteSpace.SuperfluousWhitespace.EmptyLines"/>

		<!-- No need for this sniff as every Yoast travis script includes linting all files. -->
		<exclude name="Generic.PHP.Syntax"/>

		<!-- WP VIP rules which are very restrictive and not all that applicable as WPSEO is not on VIP -->
		<exclude name="WordPress.VIP.DirectDatabaseQuery"/>
		<exclude name="WordPress.VIP.FileSystemWritesDisallow"/>

		<!-- We should probably want to turn the below rules on, but these give issues with the current code base. -->
		<!-- This sniff also has known & reported bugs -->
		<exclude name="WordPress.XSS.EscapeOutput"/>

		<!-- Demanding Yoda conditions is stupid. -->
		<exclude name="WordPress.PHP.YodaConditions"/>

		<!-- Turned off because of known & reported bugs in the Sniffs, should be turned on once the bugs are fixed. -->
		<exclude name="WordPress.VIP.ValidatedSanitizedInput"/>

		<!-- Single line one item associative arrays are fine. -->
		<exclude name="WordPress.Arrays.ArrayDeclarationSpacing.AssociativeKeyFound"/>

		<!-- Catches way too many things, like vars and file headers. -->
		<exclude name="Generic.Commenting.DocComment.MissingShort" />

		<!-- Closing comments do not make for tidy code. -->
		<exclude name="Squiz.Commenting.LongConditionClosingComment"/>
	</rule>

	<!-- Ignore some WP VIP rules which are very restrictive and not all that applicable as WPSEO is not on VIP -->
	<rule ref="WordPress.VIP.RestrictedFunctions">
		<properties>
			<property name="exclude" value="user_meta,switch_to_blog,wp_remote_get,file_get_contents,get_term_link,get_term_by,count_user_posts,url_to_postid,attachment_url_to_postid" />
		</properties>
	</rule>

	<rule ref="WordPress.VIP.RestrictedVariables">
		<properties>
			<property name="exclude" value="user_meta,cache_constraints"/>
		</properties>
	</rule>

	<rule ref="WordPress.VIP.PostsPerPage">
		<properties>
			<property name="exclude" value="posts_per_page"/>
		</properties>
	</rule>

	<!-- Whitelist the Yoast base test classes so that overruling global variables in test files is not flagged. -->
	<rule ref="WordPress.Variables.GlobalVariables">
		<properties>
			<property name="custom_test_class_whitelist" type="array" value="WPSEO_UnitTestCase,VideoSEO_UnitTestCase,WPSEO_WooCommerce_UnitTestCase,WPSEO_News_UnitTestCase,Yst_License_Manager_UnitTestCase,Clicky_UnitTestCase"/>
		</properties>
	</rule>

	<!-- Allow more freedom in the filenames used for classes. -->
	<rule ref="WordPress.Files.FileName">
		<properties>
			<property name="strict_class_file_names" value="false"/>
		</properties>
	</rule>

	<!-- ##### Sniffs for PHP cross-version compatibility ##### -->
	<!-- Currently disabled because it does not play nice with Composer.
	     This is being worked on in https://github.com/wimg/PHPCompatibility/issues/102 -->
	<!--<config name="testVersion" value="5.2-99.0"/>-->
	<!--<rule ref="PHPCompatibility"/>-->

	<rule ref="Squiz.ControlStructures">
		<!-- Prevent errors for Spaces after closing braces, as we want a newline -->
		<exclude name="Squiz.ControlStructures.ControlSignature.SpaceAfterCloseBrace"/>
		<!-- elseif is fine by WP -->
		<exclude name="Squiz.ControlStructures.ElseIfDeclaration"/>
		<!-- WP got nothing about switch -->
		<exclude name="Squiz.ControlStructures.SwitchDeclaration"/>
	</rule>

	<!-- ##### Some miscellanous other sniffs ##### -->
	<!-- Added for lowercase keywords check -->
	<rule ref="Squiz.ControlStructures.ForEachLoopDeclaration">
		<properties>
			<property name="requiredSpacesAfterOpen" value="1"/>
			<property name="requiredSpacesBeforeClose" value="1"/>
		</properties>
	</rule>

	<rule ref="Squiz.ControlStructures.ForLoopDeclaration">
		<properties>
			<property name="requiredSpacesAfterOpen" value="1"/>
			<property name="requiredSpacesBeforeClose" value="1"/>
		</properties>
	</rule>

	<!-- Error prevention: Make sure the condition in a inline if declaration is bracketed -->
	<rule ref="Squiz.ControlStructures.InlineIfDeclaration"/>

	<!-- Error prevention: Make sure arithmetics are bracketed -->
	<rule ref="Squiz.Formatting.OperatorBracket.MissingBrackets"/>

	<!-- Should be turned on, but gives issue with current codebase -->
	<!--<rule ref="Generic.CodeAnalysis.EmptyStatement" />-->

	<!-- ##### Documentation Sniffs vs empty index files ##### -->

	<!-- exclude the 'empty' index files from some documentation checks -->
	<rule ref="Squiz.Commenting.FileComment">
		<exclude-pattern>*/index.php</exclude-pattern>
	</rule>
	<rule ref="Squiz.Commenting.InlineComment.NoSpaceBefore">
		<exclude-pattern>*/index.php</exclude-pattern>
	</rule>
</ruleset>
